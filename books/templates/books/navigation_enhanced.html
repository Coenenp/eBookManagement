<!-- Top Authentication Bar -->
<nav class="navbar navbar-expand-lg navbar-light bg-light border-bottom shadow-sm">
    <div class="container">
        <a class="navbar-brand fw-bold text-primary" href="{% url 'books:dashboard' %}">
            <i class="fas fa-book me-1"></i>eBook Library
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarNav" aria-controls="navbarNav"
                aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
            <ul class="navbar-nav align-items-center" role="list">
                {% if user.is_authenticated %}
                    <li class="nav-item dropdown me-3" role="listitem">
                        <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" id="userDropdown" 
                           role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fas fa-user-circle me-1"></i>
                            <span class="d-none d-sm-inline">{{ user.username }}</span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                            <li><h6 class="dropdown-header">{{ user.get_full_name|default:user.username }}</h6></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="{% url 'books:user_settings' %}">
                                <i class="fas fa-cog me-2"></i>Settings
                            </a></li>
                            <li><a class="dropdown-item" href="{% url 'books:dashboard' %}">
                                <i class="fas fa-tachometer-alt me-2"></i>Dashboard
                            </a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li>
                                <form action="{% url 'books:logout' %}" method="post" class="dropdown-item p-0">
                                    {% csrf_token %}
                                    <button type="submit" class="btn btn-link dropdown-item border-0 text-start">
                                        <i class="fas fa-sign-out-alt me-2"></i>Sign out
                                    </button>
                                </form>
                            </li>
                        </ul>
                    </li>
                {% else %}
                    <li class="nav-item me-2" role="listitem">
                        <a class="btn btn-outline-primary btn-sm" href="{% url 'books:login' %}">Sign in</a>
                    </li>
                    <li class="nav-item" role="listitem">
                        <a class="btn btn-outline-success btn-sm" href="{% url 'books:signup' %}">Sign up</a>
                    </li>
                {% endif %}
            </ul>
        </div>
    </div>
</nav>

<!-- Main Navigation Tabs -->
<nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm">
    <div class="container">
        <div class="collapse navbar-collapse justify-content-center" id="mainNavTabs">
            <ul class="nav nav-tabs nav-tabs-enhanced border-0 flex-wrap">
                <!-- Dashboard Tab -->
                <li class="nav-item">
                    <a class="nav-link {% if request.resolver_match.url_name == 'dashboard' %}active bg-white text-primary{% else %}text-white{% endif %}" 
                       href="{% url 'books:dashboard' %}">
                        <i class="fas fa-tachometer-alt me-2"></i>
                        <span class="d-none d-md-inline">Dashboard</span>
                    </a>
                </li>

                <!-- Ebooks Tab -->
                <li class="nav-item">
                    <a class="nav-link {% if 'ebooks' in request.resolver_match.url_name %}active bg-white text-primary{% else %}text-white{% endif %}" 
                       href="{% url 'books:ebooks_main' %}">
                        <i class="fas fa-book me-2"></i>
                        <span class="d-none d-md-inline">Ebooks</span>
                    </a>
                </li>

                <!-- Series Tab -->
                <li class="nav-item">
                    <a class="nav-link {% if 'series' in request.resolver_match.url_name %}active bg-white text-primary{% else %}text-white{% endif %}" 
                       href="{% url 'books:series_main' %}">
                        <i class="fas fa-layer-group me-2"></i>
                        <span class="d-none d-md-inline">Series</span>
                    </a>
                </li>

                <!-- Comics Tab -->
                <li class="nav-item">
                    <a class="nav-link {% if 'comics' in request.resolver_match.url_name %}active bg-white text-primary{% else %}text-white{% endif %}" 
                       href="{% url 'books:comics_main' %}">
                        <i class="fas fa-mask me-2"></i>
                        <span class="d-none d-md-inline">Comics</span>
                    </a>
                </li>

                <!-- Audiobooks Tab -->
                <li class="nav-item">
                    <a class="nav-link {% if 'audiobooks' in request.resolver_match.url_name %}active bg-white text-primary{% else %}text-white{% endif %}" 
                       href="{% url 'books:audiobooks_main' %}">
                        <i class="fas fa-headphones me-2"></i>
                        <span class="d-none d-md-inline">Audiobooks</span>
                    </a>
                </li>

                <!-- Scanning Tab -->
                <li class="nav-item">
                    <a class="nav-link {% if 'scan' in request.resolver_match.url_name %}active bg-white text-primary{% else %}text-white{% endif %}" 
                       href="{% url 'books:scan_dashboard' %}">
                        <i class="fas fa-search me-2"></i>
                        <span class="d-none d-md-inline">Scanning</span>
                    </a>
                </li>

                <!-- Management Tab (Dropdown) -->
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle {% if request.resolver_match.url_name in 'author_list,genre_list,data_source_list,book_renamer,scan_folder_list' %}active bg-white text-primary{% else %}text-white{% endif %}" 
                       href="#" id="managementDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Management menu">
                        <i class="fas fa-cogs me-2"></i>
                        <span class="d-none d-md-inline">Management</span>
                    </a>
                    <ul class="dropdown-menu" aria-labelledby="managementDropdown">
                        <li><a class="dropdown-item" href="{% url 'books:author_list' %}">
                            <i class="fas fa-users me-2"></i>Authors</a></li>
                        <li><a class="dropdown-item" href="{% url 'books:genre_list' %}">
                            <i class="fas fa-tags me-2"></i>Genres</a></li>
                        <li><a class="dropdown-item" href="{% url 'books:data_source_list' %}">
                            <i class="fas fa-database me-2"></i>Data Sources</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="{% url 'books:scan_folder_list' %}">
                            <i class="fas fa-folder me-2"></i>Scan Folders</a></li>
                        <li><a class="dropdown-item" href="{% url 'books:add_scan_folder' %}">
                            <i class="fas fa-plus me-2"></i>Add Scan Folder</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="{% url 'books:book_renamer' %}">
                            <i class="fas fa-edit me-2"></i>Rename Books</a></li>
                        <li><a class="dropdown-item" href="{% url 'books:ai_feedback_list' %}">
                            <i class="fas fa-robot me-2"></i>AI Feedback</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</nav>

<!-- Enhanced navigation styles already included in navigation.css -->