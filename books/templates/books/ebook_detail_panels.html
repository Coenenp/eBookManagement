<!-- Enhanced Ebook Detail Panel Template -->
<div class="ebook-detail-wrapper h-100">
    <!-- Header with book title and cover -->
    <div class="detail-header p-3 border-bottom bg-white sticky-top">
        <div class="row align-items-center">
            <div class="col-auto">
                <div class="detail-cover-small">
                    ${ebook.cover_url ? `
                        <img src="${ebook.cover_url}" alt="Book Cover" class="img-fluid rounded shadow-sm">
                    ` : `
                        <div class="placeholder-cover d-flex align-items-center justify-content-center bg-light rounded">
                            <i class="fas fa-book text-muted"></i>
                        </div>
                    `}
                </div>
            </div>
            <div class="col">
                <h4 class="mb-1 text-truncate">${ebook.title}</h4>
                <p class="text-muted mb-1">${ebook.author || 'Unknown Author'}</p>
                <div class="d-flex align-items-center gap-2">
                    ${ebook.series ? `<span class="badge bg-secondary">${ebook.series}</span>` : ''}
                    ${ebook.format ? `<span class="badge bg-info">${ebook.format.toUpperCase()}</span>` : ''}
                    ${ebook.language ? `<span class="badge bg-success">${ebook.language.toUpperCase()}</span>` : ''}
                </div>
            </div>
            <div class="col-auto">
                <div class="btn-group" role="group">
                    <button type="button" class="btn btn-outline-primary btn-sm" data-ebook-id="${ebook.id}" onclick="editEbook(this.getAttribute('data-ebook-id'))">
                        <i class="fas fa-edit me-1"></i>Edit
                    </button>
                    <button type="button" class="btn btn-outline-secondary btn-sm" data-ebook-id="${ebook.id}" onclick="downloadEbook(this.getAttribute('data-ebook-id'))">
                        <i class="fas fa-download me-1"></i>Download
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Tabbed Content Area -->
    <div class="detail-tabs-container flex-grow-1 d-flex flex-column">
        <!-- Tab Navigation -->
        <ul class="nav nav-tabs nav-justified border-bottom" id="ebookDetailTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="details-tab" data-bs-toggle="tab" 
                        data-bs-target="#details-panel" type="button" role="tab">
                    <i class="fas fa-info-circle me-2"></i>Details
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="media-files-tab" data-bs-toggle="tab" 
                        data-bs-target="#media-files-panel" type="button" role="tab">
                    <i class="fas fa-file-alt me-2"></i>Media Files
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="covers-tab" data-bs-toggle="tab" 
                        data-bs-target="#covers-panel" type="button" role="tab">
                    <i class="fas fa-images me-2"></i>Covers
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="contributors-tab" data-bs-toggle="tab" 
                        data-bs-target="#contributors-panel" type="button" role="tab">
                    <i class="fas fa-users me-2"></i>Contributors
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="edit-metadata-tab" data-bs-toggle="tab" 
                        data-bs-target="#edit-metadata-panel" type="button" role="tab">
                    <i class="fas fa-edit me-2"></i>Edit Metadata
                </button>
            </li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content flex-grow-1 overflow-auto" id="ebookDetailTabContent">
            <!-- Details Panel -->
            <div class="tab-pane fade show active h-100" id="details-panel" role="tabpanel">
                <div class="p-3">
                    <div class="row">
                        <!-- Left column - Cover and basic info -->
                        <div class="col-md-4 mb-3">
                            <div class="card">
                                <div class="card-body text-center">
                                    ${ebook.cover_url ? `
                                        <img src="${ebook.cover_url}" alt="Book Cover" class="detail-cover img-fluid mb-3 rounded shadow">
                                    ` : `
                                        <div class="detail-cover bg-light d-flex align-items-center justify-content-center detail-cover-placeholder mb-3 rounded">
                                            <i class="fas fa-book fa-3x text-muted"></i>
                                        </div>
                                    `}
                                    
                                    <!-- Action buttons -->
                                    <div class="d-grid gap-2">
                                        <button class="btn btn-primary" data-ebook-id="${ebook.id}" onclick="openEbook(this.getAttribute('data-ebook-id'))">
                                            <i class="fas fa-book-open me-2"></i>Open Book
                                        </button>
                                        <button class="btn btn-outline-secondary" data-ebook-id="${ebook.id}" onclick="showOnDisk(this.getAttribute('data-ebook-id'))">
                                            <i class="fas fa-folder-open me-2"></i>Show in Folder
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Right column - Detailed metadata -->
                        <div class="col-md-8">
                            <div class="card">
                                <div class="card-header">
                                    <h6 class="mb-0"><i class="fas fa-info-circle me-2"></i>Book Information</h6>
                                </div>
                                <div class="card-body">
                                    <div class="row mb-3">
                                        <div class="col-sm-3"><strong>Title:</strong></div>
                                        <div class="col-sm-9">${ebook.title || 'N/A'}</div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-sm-3"><strong>Original Title:</strong></div>
                                        <div class="col-sm-9">${ebook.original_title || 'N/A'}</div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-sm-3"><strong>Author:</strong></div>
                                        <div class="col-sm-9">${ebook.author || 'Unknown'}</div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-sm-3"><strong>Publisher:</strong></div>
                                        <div class="col-sm-9">${ebook.publisher || 'N/A'}</div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-sm-3"><strong>Publication Date:</strong></div>
                                        <div class="col-sm-9">${ebook.publication_date || 'N/A'}</div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-sm-3"><strong>ISBN:</strong></div>
                                        <div class="col-sm-9">${ebook.isbn || 'N/A'}</div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-sm-3"><strong>Language:</strong></div>
                                        <div class="col-sm-9">${ebook.language || 'N/A'}</div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-sm-3"><strong>Genres:</strong></div>
                                        <div class="col-sm-9">${ebook.genres || 'N/A'}</div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-sm-3"><strong>Series:</strong></div>
                                        <div class="col-sm-9">${ebook.series || 'N/A'}</div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-sm-3"><strong>Page Count:</strong></div>
                                        <div class="col-sm-9">${ebook.page_count || 'N/A'}</div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-sm-3"><strong>Rating:</strong></div>
                                        <div class="col-sm-9">
                                            ${ebook.rating ? `
                                                <div class="rating-stars">
                                                    ${generateStarRating(ebook.rating)}
                                                    <span class="ms-2">${ebook.rating}/5</span>
                                                </div>
                                            ` : 'Not rated'}
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-sm-3"><strong>Description:</strong></div>
                                        <div class="col-sm-9">
                                            <div class="description-text">
                                                ${ebook.description || 'No description available.'}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- File System Information -->
                            <div class="card mt-3">
                                <div class="card-header">
                                    <h6 class="mb-0"><i class="fas fa-hdd me-2"></i>File System</h6>
                                </div>
                                <div class="card-body">
                                    <div class="row mb-2">
                                        <div class="col-sm-3"><strong>Path:</strong></div>
                                        <div class="col-sm-9"><code class="text-break">${ebook.file_path || 'N/A'}</code></div>
                                    </div>
                                    <div class="row mb-2">
                                        <div class="col-sm-3"><strong>Date Added:</strong></div>
                                        <div class="col-sm-9">${ebook.date_added || 'N/A'}</div>
                                    </div>
                                    <div class="row mb-2">
                                        <div class="col-sm-3"><strong>Last Scanned:</strong></div>
                                        <div class="col-sm-9">${ebook.last_scanned || 'N/A'}</div>
                                    </div>
                                    <div class="row mb-2">
                                        <div class="col-sm-3"><strong>Read Status:</strong></div>
                                        <div class="col-sm-9">
                                            ${ebook.is_read ? 
                                                '<span class="badge bg-success"><i class="fas fa-check me-1"></i>Read</span>' : 
                                                '<span class="badge bg-secondary"><i class="fas fa-clock me-1"></i>Unread</span>'
                                            }
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Media Files Panel -->
            <div class="tab-pane fade h-100" id="media-files-panel" role="tabpanel">
                <div class="p-3">
                    <div class="card">
                        <div class="card-header">
                            <h6 class="mb-0"><i class="fas fa-file-alt me-2"></i>Main Book File</h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="row mb-2">
                                        <div class="col-4"><strong>Filename:</strong></div>
                                        <div class="col-8"><code>${ebook.filename || 'N/A'}</code></div>
                                    </div>
                                    <div class="row mb-2">
                                        <div class="col-4"><strong>Format:</strong></div>
                                        <div class="col-8">${ebook.format ? ebook.format.toUpperCase() : 'N/A'}</div>
                                    </div>
                                    <div class="row mb-2">
                                        <div class="col-4"><strong>File Size:</strong></div>
                                        <div class="col-8">${ebook.file_size || 'N/A'}</div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="row mb-2">
                                        <div class="col-4"><strong>Full Path:</strong></div>
                                        <div class="col-8"><code class="text-break">${ebook.file_path || 'N/A'}</code></div>
                                    </div>
                                    <div class="row mb-2">
                                        <div class="col-4"><strong>Scan Folder:</strong></div>
                                        <div class="col-8">${ebook.scan_folder || 'N/A'}</div>
                                    </div>
                                    <div class="row mb-2">
                                        <div class="col-4"><strong>Source:</strong></div>
                                        <div class="col-8">${ebook.source || 'Local'}</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Companion Files -->
                    <div class="card mt-3">
                        <div class="card-header">
                            <h6 class="mb-0"><i class="fas fa-files me-2"></i>Companion Files</h6>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-sm">
                                    <thead>
                                        <tr>
                                            <th>Filename</th>
                                            <th>Size</th>
                                            <th>Type</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="companion-files-list">
                                        <!-- Companion files will be loaded here -->
                                        <tr>
                                            <td colspan="4" class="text-center text-muted">No companion files found</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Covers Panel -->
            <div class="tab-pane fade h-100" id="covers-panel" role="tabpanel">
                <div class="p-3">
                    <div class="row" id="covers-gallery">
                        ${ebook.cover_url ? `
                            <div class="col-md-3 mb-3">
                                <div class="card">
                                    <img src="${ebook.cover_url}" class="card-img-top" alt="Cover">
                                    <div class="card-body text-center">
                                        <small class="text-muted">Primary Cover</small>
                                    </div>
                                </div>
                            </div>
                        ` : `
                            <div class="col-12 text-center text-muted">
                                <i class="fas fa-image fa-3x mb-3"></i>
                                <p>No cover images available</p>
                            </div>
                        `}
                    </div>
                </div>
            </div>

            <!-- Contributors Panel -->
            <div class="tab-pane fade h-100" id="contributors-panel" role="tabpanel">
                <div class="p-3">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h6 class="mb-0"><i class="fas fa-user-edit me-2"></i>Authors</h6>
                                </div>
                                <div class="card-body">
                                    <div class="contributor-item d-flex align-items-center mb-2">
                                        <div class="contributor-avatar me-3">
                                            <i class="fas fa-user-circle fa-2x text-muted"></i>
                                        </div>
                                        <div>
                                            <strong>${ebook.author || 'Unknown Author'}</strong>
                                            <div class="text-muted small">Primary Author</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h6 class="mb-0"><i class="fas fa-users me-2"></i>Other Contributors</h6>
                                </div>
                                <div class="card-body">
                                    <p class="text-muted">No additional contributors found</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Edit Metadata Panel -->
            <div class="tab-pane fade h-100" id="edit-metadata-panel" role="tabpanel">
                <div class="p-3">
                    <div class="card">
                        <div class="card-header">
                            <h6 class="mb-0"><i class="fas fa-edit me-2"></i>Edit Book Metadata</h6>
                        </div>
                        <div class="card-body">
                            <form id="edit-metadata-form">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label" for="edit-title">Title</label>
                                            <input type="text" class="form-control" id="edit-title" value="${ebook.title || ''}" name="title">
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label" for="edit-author">Author</label>
                                            <input type="text" class="form-control" id="edit-author" value="${ebook.author || ''}" name="author">
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label" for="edit-publisher">Publisher</label>
                                            <input type="text" class="form-control" id="edit-publisher" value="${ebook.publisher || ''}" name="publisher">
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label" for="edit-isbn">ISBN</label>
                                            <input type="text" class="form-control" id="edit-isbn" value="${ebook.isbn || ''}" name="isbn">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label" for="edit-publication-date">Publication Date</label>
                                            <input type="date" class="form-control" id="edit-publication-date" value="${ebook.publication_date || ''}" name="publication_date">
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label" for="edit-language">Language</label>
                                            <select class="form-control" id="edit-language" name="language">
                                                <option value="en" ${ebook.language === 'en' ? 'selected' : ''}>English</option>
                                                <option value="fr" ${ebook.language === 'fr' ? 'selected' : ''}>French</option>
                                                <option value="de" ${ebook.language === 'de' ? 'selected' : ''}>German</option>
                                                <option value="es" ${ebook.language === 'es' ? 'selected' : ''}>Spanish</option>
                                            </select>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label" for="edit-genres">Genres</label>
                                            <input type="text" class="form-control" id="edit-genres" value="${ebook.genres || ''}" name="genres">
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label" for="edit-rating">Rating</label>
                                            <select class="form-control" id="edit-rating" name="rating">
                                                <option value="">No Rating</option>
                                                <option value="1" ${ebook.rating === 1 ? 'selected' : ''}>1 Star</option>
                                                <option value="2" ${ebook.rating === 2 ? 'selected' : ''}>2 Stars</option>
                                                <option value="3" ${ebook.rating === 3 ? 'selected' : ''}>3 Stars</option>
                                                <option value="4" ${ebook.rating === 4 ? 'selected' : ''}>4 Stars</option>
                                                <option value="5" ${ebook.rating === 5 ? 'selected' : ''}>5 Stars</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label" for="edit-description">Description</label>
                                    <textarea class="form-control" id="edit-description" rows="4" name="description">${ebook.description || ''}</textarea>
                                </div>
                                <div class="d-flex justify-content-end">
                                    <button type="button" class="btn btn-secondary me-2" onclick="resetMetadataForm()">Reset</button>
                                    <button type="submit" class="btn btn-primary">Save Changes</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>