{% extends "books/base.html" %}

{% block title %}AI Feedback - {{ book.finalmetadata.final_title|default:"Unknown Book" }}{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-md-12">
            <h2>AI Feedback for {{ book.finalmetadata.final_title|default:"Unknown Book" }}</h2>
            
            {% if book.finalmetadata %}
                <div class="card">
                    <div class="card-header">
                        <h4>Book Metadata</h4>
                    </div>
                    <div class="card-body">
                        <p><strong>Title:</strong> {{ book.finalmetadata.final_title|default:"N/A" }}</p>
                        <p><strong>Author:</strong> {{ book.finalmetadata.final_author|default:"N/A" }}</p>
                        <p><strong>Series:</strong> {{ book.finalmetadata.final_series|default:"N/A" }}</p>
                        <p><strong>Publisher:</strong> {{ book.finalmetadata.final_publisher|default:"N/A" }}</p>
                        <p><strong>Confidence:</strong> {{ book.finalmetadata.overall_confidence|floatformat:2 }}%</p>
                    </div>
                </div>
            {% else %}
                <div class="alert alert-warning">
                    <h4>No Metadata Available</h4>
                    <p>This book does not have any final metadata yet.</p>
                </div>
            {% endif %}

            {% if ai_predictions %}
                <div class="card mt-3">
                    <div class="card-header">
                        <h4>AI Predictions</h4>
                    </div>
                    <div class="card-body">
                        {% for field, prediction in ai_predictions.items %}
                            <div class="row mb-2">
                                <div class="col-md-3"><strong>{{ field|title }}:</strong></div>
                                <div class="col-md-6">{{ prediction.value }}</div>
                                <div class="col-md-3">Confidence: {{ prediction.confidence|floatformat:2 }}%</div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            {% else %}
                <div class="alert alert-info">
                    <p>No AI predictions available for this book.</p>
                </div>
            {% endif %}

            <div class="mt-3">
                <a href="{% url 'books:ai_feedback_list' %}" class="btn btn-secondary">Back to AI Feedback List</a>
            </div>
        </div>
    </div>
</div>
{% endblock %}