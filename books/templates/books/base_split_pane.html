{% extends "books/base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'book/css/split-pane-optimized.css' %}">
<link rel="stylesheet" href="{% static 'book/css/filter-section.css' %}">
{% endblock %}

{% block content %}
<div class="container-fluid h-100">
    <div class="row h-100">
        <!-- Left Panel - List View -->
        <div class="col-md-4 col-lg-3 border-end bg-light h-100 d-flex flex-column" id="list-panel">
            <div class="p-3 border-bottom bg-white sticky-top">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5 class="mb-0">
                        <i class="{% block list_icon %}fas fa-list{% endblock %} me-2"></i>
                        {% block list_title %}Items{% endblock %}
                    </h5>
                    <div class="d-flex align-items-center gap-2">
                        <span class="badge bg-primary" id="item-count">
                            {% block item_count %}0{% endblock %}
                        </span>
                        <!-- View Toggle Buttons -->
                        <div class="btn-group btn-group-sm" role="group" aria-label="View options">
                            <button type="button" class="btn btn-outline-secondary active" id="list-view-btn" onclick="toggleView('list')" title="List View">
                                <i class="fas fa-list"></i>
                            </button>
                            <button type="button" class="btn btn-outline-secondary" id="grid-view-btn" onclick="toggleView('grid')" title="Grid View">
                                <i class="fas fa-th"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Enhanced Filters -->
                {% block filters %}
                <div class="filter-section">
                    <!-- Search Bar with Icon -->
                    <div class="position-relative mb-3">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" class="form-control form-control-sm ps-5" 
                               id="search-filter" placeholder="{% block search_placeholder %}Search...{% endblock %}">
                        <button class="btn btn-sm btn-outline-secondary clear-search-btn" id="clear-search" 
                                onclick="clearSearch()" title="Clear search">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <!-- Filter Controls Row -->
                    <div class="row g-2">
                        <div class="col-6">
                            <select class="form-select form-select-sm" id="sort-filter" aria-label="Sort options">
                                <option value="title">📚 Title</option>
                                <option value="author">👤 Author</option>
                                <option value="date">📅 Date</option>
                                <option value="size">💾 Size</option>
                            </select>
                        </div>
                        <div class="col-6">
                            <select class="form-select form-select-sm" id="format-filter" aria-label="Format filter">
                                <option value="">🔄 All Formats</option>
                                {% block format_options %}{% endblock %}
                            </select>
                        </div>
                    </div>
                    
                    <!-- Quick Action Buttons -->
                    <div class="d-flex justify-content-between mt-2">
                        <button class="btn btn-outline-primary btn-sm" onclick="refreshItems()" title="Refresh">
                            <i class="fas fa-sync-alt me-1"></i>Refresh
                        </button>
                        <button class="btn btn-outline-secondary btn-sm" onclick="toggleFilters()" title="More Filters">
                            <i class="fas fa-filter me-1"></i>Filters
                        </button>
                    </div>
                    
                    <!-- Advanced Filters (Initially Hidden) -->
                    <div class="advanced-filters mt-2 d-none" id="advanced-filters">
                        <div class="row g-2">
                            <div class="col-12">
                                <select class="form-select form-select-sm" id="status-filter" aria-label="Status filter">
                                    <option value="">📊 All Status</option>
                                    <option value="read">✅ Read</option>
                                    <option value="unread">⏳ Unread</option>
                                    <option value="reading">📖 Reading</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                {% endblock %}
            </div>

            <!-- Scrollable List with View Container -->
            <div class="flex-grow-1 overflow-auto p-0" id="items-list">
                <div id="view-container" class="list-view">
                    {% block items_list %}
                    <div class="text-center p-4 text-muted">
                        <div class="spinner-border text-primary mb-3" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <p>Loading items...</p>
                    </div>
                    {% endblock %}
                </div>
            </div>
        </div>

        <!-- Right Panel - Detail View -->
        <div class="col-md-8 col-lg-9 h-100 d-flex flex-column" id="detail-panel">
            <div class="flex-grow-1 overflow-auto">
                {% block detail_content %}
                <div class="d-flex align-items-center justify-content-center h-100 text-muted">
                    <div class="text-center">
                        <i class="{% block detail_icon %}fas fa-arrow-left{% endblock %} fa-3x mb-3"></i>
                        <h5>{% block detail_message %}Select an item to view details{% endblock %}</h5>
                        <p class="text-muted mb-0">Choose from the list on the left to see detailed information</p>
                    </div>
                </div>
                {% endblock %}
            </div>
        </div>
    </div>
</div>

<!-- Enhanced Resize Handle -->
<div class="resize-handle" data-direction="horizontal"></div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'book/js/split-pane.js' %}"></script>
<script src="{% static 'book/js/base-split-pane.js' %}"></script>
{% endblock %}