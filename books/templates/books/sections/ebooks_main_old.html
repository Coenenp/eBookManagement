{% extends "books/base.html" %}
{% load static %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'book/css/sections.css' %}">
{% endblock %}

{% block content %}
<!-- Split Pane Layout -->
<div class="split-pane-container">
    <!-- Left Panel (List) -->
    <div class="split-pane-left" id="list-panel">
        <div class="p-3 border-bottom bg-white sticky-top">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="mb-0">
                    <i class="fas fa-book me-2"></i>
                    Ebooks
                </h5>
                <div class="d-flex align-items-center gap-2">
                    <span class="badge bg-primary" id="item-count">{{ ebooks_count }}</span>
                    <!-- View Toggle Buttons -->
                    <div class="btn-group btn-group-sm" role="group" aria-label="View options">
                        <button type="button" class="btn btn-outline-secondary view-toggle-btn active" data-view="list" title="List View">
                            <i class="fas fa-list"></i>
                        </button>
                        <button type="button" class="btn btn-outline-secondary view-toggle-btn" data-view="grid" title="Grid View">
                            <i class="fas fa-th"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Enhanced Filters -->
            <div class="filter-section">
                <!-- Search Bar with Icon -->
                <div class="position-relative mb-3">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" class="form-control form-control-sm ps-5" id="search-input" placeholder="Search ebooks by title, author...">
                    <button class="btn btn-sm btn-outline-secondary clear-search-btn" id="clear-search" title="Clear search" style="display: none;">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <!-- Filter Controls Row -->
                <div class="row g-2">
                    <div class="col-6">
                        <select class="form-select form-select-sm" id="sort-select" aria-label="Sort options">
                            <option value="title">üìö Title</option>
                            <option value="author">üë§ Author</option>
                            <option value="date">üìÖ Date</option>
                            <option value="size">üíæ Size</option>
                        </select>
                    </div>
                    <div class="col-6">
                        <select class="form-select form-select-sm" id="format-filter" aria-label="Format filter">
                            <option value="">üîÑ All Formats</option>
                            <option value="epub">EPUB</option>
                            <option value="pdf">PDF</option>
                            <option value="mobi">MOBI</option>
                            <option value="azw">AZW</option>
                            <option value="azw3">AZW3</option>
                            <option value="fb2">FB2</option>
                            <option value="lit">LIT</option>
                            <option value="prc">PRC</option>
                        </select>
                    </div>
                </div>
                
                <!-- Quick Action Buttons -->
                <div class="d-flex justify-content-between mt-2">
                    <button class="btn btn-outline-primary btn-sm refresh-btn" title="Refresh">
                        <i class="fas fa-sync-alt me-1"></i>Refresh
                    </button>
                    <button class="btn btn-outline-secondary btn-sm filters-btn" title="More Filters">
                        <i class="fas fa-filter me-1"></i>Filters
                    </button>
                </div>
                
                <!-- Advanced Filters (Initially Hidden) -->
                <div class="advanced-filters mt-2 d-none" id="advanced-filters">
                    <div class="row g-2">
                        <div class="col-12">
                            <select class="form-select form-select-sm" id="read-status-filter" aria-label="Status filter">
                                <option value="">üìä All Status</option>
                                <option value="read">‚úÖ Read</option>
                                <option value="unread">‚è≥ Unread</option>
                                <option value="reading">üìñ Reading</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- List Container -->
        <div id="ebooks-list-container" class="list-container">
            <!-- Ebooks will be rendered here by JavaScript -->
            <div class="text-center p-5">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <p class="mt-3 text-muted">Loading ebooks...</p>
            </div>
        </div>
    </div>

    <!-- Resizer -->
    <div class="split-pane-resizer" id="resizer"></div>

    <!-- Right Panel (Detail) -->
    <div class="split-pane-right" id="detail-panel">
        <div id="ebook-detail-container" class="detail-container h-100">
            <!-- Detail view will be rendered here by JavaScript -->
            <div class="d-flex align-items-center justify-content-center h-100 text-muted">
                <div class="text-center">
                    <i class="fas fa-book fa-3x mb-3"></i>
                    <p>Select an ebook to view details</p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
    <!-- Only configuration, no script tags for JS files that are already in base.html -->
    <script>
        // Configuration for ebooks section
        window.ebooksConfig = {
            ajax_urls: {
                list: '{% url "books:ebooks_ajax_list" %}',
                detail: '/books/ebooks/ajax/detail/0/',
                toggle_read: '{% url "books:ebooks_ajax_toggle_read" %}',
                download: '/books/ebooks/ajax/download/0/',
                companion_files: '/books/ebooks/ajax/companion_files/0/'
            },
            urls: {
                detail: '/books/book/0/'
            }
        };
    </script>
{% endblock %}