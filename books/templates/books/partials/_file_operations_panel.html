{# File operations panel for rename/move with pattern preview #}

<div class="card mb-3">
    <div class="card-header bg-light">
        <h5 class="mb-0"><i class="fas fa-folder-open"></i> Rename & Move Configuration</h5>
    </div>
    <div class="card-body">
        <!-- Rename Templates -->
        {% if rename_templates %}
        <div class="row mb-3">
            <div class="col-12">
                <label class="form-label">
                    Templates 
                    <a href="{% url 'books:book_renamer' %}" class="btn btn-sm btn-outline-secondary ms-2" target="_blank">
                        <i class="fas fa-cog"></i> Manage Templates
                    </a>
                </label>
                <select class="form-select" id="pattern_preset" onchange="applyPatternPreset()">
                    <option value="">-- Select a template --</option>
                    {% for preset in rename_templates %}
                    <option value="{{ forloop.counter0 }}" 
                            data-folder="{{ preset.folder }}" 
                            data-filename="{{ preset.filename }}"
                            {% if preset.is_custom %}data-custom="true"{% endif %}>
                        {{ preset.name }}{% if preset.is_custom %} ⭐{% endif %}
                    </option>
                    {% endfor %}
                </select>
                <small class="text-muted">⭐ = Your custom templates | Create and manage templates in the <a href="{% url 'books:book_renamer' %}" target="_blank">Rename Books</a> section</small>
            </div>
        </div>
        {% endif %}
        
        <div class="row">
            <div class="col-md-6 mb-3">
                <label class="form-label">Folder Pattern</label>
                <input type="text" class="form-control" 
                       name="folder_pattern" 
                       id="folder_pattern" 
                       value="{{ folder_pattern }}" 
                       oninput="updateRenamePreview()">
                <small class="text-muted">Available: ${title}, ${author}, ${author.sortname}, ${series}, ${year}, ${genre}</small>
            </div>
            <div class="col-md-6 mb-3">
                <label class="form-label">Filename Pattern</label>
                <input type="text" class="form-control" 
                       name="filename_pattern" 
                       id="filename_pattern" 
                       value="{{ filename_pattern }}" 
                       oninput="updateRenamePreview()">
                <small class="text-muted">Available: ${title}, ${author}, ${series}, ${series_number}, ${year}, ${ext}</small>
            </div>
        </div>
        
        <div class="row mb-3">
            <div class="col-12">
                <label class="form-label fw-bold">Preview Path:</label>
                <div class="alert alert-info mb-0" id="rename-preview-path">
                    <code id="preview-path-text">{{ preview_path }}</code>
                </div>
            </div>
        </div>
        
        <div class="form-check mb-2">
            <input class="form-check-input" type="checkbox" 
                   name="include_companions" 
                   id="include_companions" 
                   checked>
            <label class="form-check-label" for="include_companions">
                Include companion files (covers, OPF, metadata, etc.)
            </label>
        </div>
        
        {% if companion_files %}
        <div class="mt-2">
            <small class="text-muted">
                <strong>Companion files found ({{ companion_files|length }}):</strong> 
                {% for comp in companion_files %}
                    <span class="badge bg-light text-dark">{{ comp.name }}</span>
                {% endfor %}
            </small>
        </div>
        {% endif %}
    </div>
</div>

<!-- Current File Info -->
{% if file_path %}
<div class="card">
    <div class="card-header bg-light">
        <h5 class="mb-0"><i class="fas fa-file"></i> Current File</h5>
    </div>
    <div class="card-body">
        <p class="mb-1"><strong>Path:</strong></p>
        <code class="d-block bg-light p-2 rounded">{{ file_path }}</code>
    </div>
</div>
{% endif %}
